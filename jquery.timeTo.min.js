/**
 * TimeTo jQuery plug-in
 * Show countdown timer or realtime clock
 *
 * @author Alexey Teterin <altmoc@gmail.com>
 * @version 1.0.13
 * @license MIT http://opensource.org/licenses/MIT
 * @date 2014-01-17
 */
(function(a){if(typeof exports==="object"){var b=require("jquery");module.exports=a(b||$)}else{if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(b||$)}}}(function(c){var d={callback:null,captionSize:0,countdown:true,countdownAlertLimit:10,displayCaptions:false,displayDays:0,displayHours:true,fontFamily:"Verdana, sans-serif",fontSize:28,lang:"en",seconds:0,start:true,theme:"white",vals:[0,0,0,0,0,0,0,0,0],limits:[9,9,9,2,9,5,9,5,9],iSec:8,iHour:4,tickTimeout:1000,intervalId:null};var a={start:function(g){if(g){e.call(this,g)}var i=this,h=setTimeout(function(){b.call(i)},1000);this.data("ttStartTime",(new Date()).getTime());this.data("intervalId",h)},stop:function(){var g=this.data();if(g.intervalId){clearTimeout(g.intervalId);this.data("intervalId",null)}return g},reset:function(g){var h=a.stop.call(this);this.find("div").css({backgroundPosition:"left center"});this.find("ul").parent().removeClass("timeTo-alert");if(typeof g==="undefined"){g=h.value}e.call(this,g,true)}};var f={en:{days:"days",hours:"hours",min:"minutes",sec:"seconds"},ru:{days:"дней",hours:"часов",min:"минут",sec:"секунд"},ua:{days:"днiв",hours:"годин",min:"хвилин",sec:"секунд"},de:{days:"Tag",hours:"Uhr",min:"Minuten",sec:"Secunden"},fr:{days:"jours",hours:"heures",min:"minutes",sec:"secondes"},sp:{days:"días",hours:"horas",min:"minutos",sec:"segundos"},it:{days:"giorni",hours:"ore",min:"minuti",sec:"secondi"},nl:{days:"dagen",hours:"uren",min:"minuten",sec:"seconden"},no:{days:"dager",hours:"timer",min:"minutter",sec:"sekunder"},pt:{days:"dias",hours:"horas",min:"minutos",sec:"segundos"},tr:{days:"gün",hours:"saat",min:"dakika",sec:"saniye"}};if(typeof c.support.transition==="undefined"){c.support.transition=(function(){var h=document.body||document.documentElement,i=h.style,g=i.transition!==undefined||i.WebkitTransition!==undefined||i.MozTransition!==undefined||i.MsTransition!==undefined||i.OTransition!==undefined;return g})()}c.fn.timeTo=function(){var g,u={};for(var l=0,s;s=arguments[l];++l){if(l==0&&typeof s==="string"){g=s}else{if(typeof s==="object"){if(typeof s.getTime==="function"){u.timeTo=s}else{u=c.extend(u,s)}}else{if(typeof s==="function"){u.callback=s}else{var p=parseInt(s,10);if(!isNaN(p)){u.seconds=p}}}}}if(u.timeTo){var k,h=(new Date()).getTime();if(u.timeTo.getTime){k=u.timeTo.getTime()}else{if(typeof u.timeTo==="number"){k=u.timeTo}}if(u.timeTo>h){u.seconds=Math.floor((k-h)/1000)}}else{if(u.time||!u.seconds){var k=u.time;if(!k){k=new Date()}if(typeof k==="object"&&k.getTime){u.seconds=k.getHours()*3600+k.getMinutes()*60+k.getSeconds();u.countdown=false}else{if(typeof k==="string"){var o=k.split(":"),n=0,j=1,r;while(r=o.pop()){n+=r*j;j*=60}u.seconds=n;u.countdown=false}}}}if(u.countdown!==false&&u.seconds>86400&&typeof u.displayDays==="undefined"){var q=Math.floor(u.seconds/86400);u.displayDays=q<10&&1||q<100&&2||3}else{if(u.displayDays===true){u.displayDays=3}else{if(u.displayDays){u.displayDays=u.displayDays>0?Math.floor(u.displayDays):3}}}return this.each(function(){var x=c(this),K=x.data(),G;if(K.intervalId){clearInterval(K.intervalId);K.intervalId=null}if(!K.vals||g==="reset"){if(K.options){u=K.options}K=c.extend(d,u);K.options=u;K.height=Math.round(K.fontSize*100/93);K.width=Math.round(K.fontSize*0.8+K.height*0.13);K.displayHours=!!(K.displayDays||K.displayHours);x.addClass("timeTo").addClass("timeTo-"+K.theme).css({fontFamily:K.fontFamily,fontSize:K.fontSize+"px"});var v=Math.round(K.height/10),z='<ul style="left:'+v+"px; top:-"+K.height+'px"><li>0</li><li>0</li></ul></div>',H=' style="width:'+K.width+"px; height:"+K.height+'px;"',E='<div class="first"'+H+">"+z,D="<div"+H+">"+z,F="<span>:</span>",I=Math.round(K.width*2+3),B=K.captionSize||Math.round(K.fontSize*0.43),m=(K.displayCaptions?(K.displayHours?'<figure style="max-width:'+I+'px">$1<figcaption style="font-size:'+B+'px">'+f[K.lang].hours+"</figcaption></figure>"+F:"")+'<figure style="max-width:'+I+'px">$1<figcaption style="font-size:'+B+'px">'+f[K.lang].min+"</figcaption></figure>"+F+'<figure style="max-width:'+I+'px">$1<figcaption style="font-size:'+B+'px">'+f[K.lang].sec+"</figcaption></figure>":(K.displayHours?"$1"+F:"")+"$1"+F+"$1").replace(/\$1/g,E+D);if(K.displayDays>0){var w=K.fontSize*0.4,t=E;for(G=K.displayDays-1;G>0;G--){t+=G===1?D.replace('">'," margin-right:"+Math.round(w)+'px">'):D}m=(K.displayCaptions?'<figure style="width:'+Math.round(K.width*K.displayDays+w+4)+'px">$1<figcaption style="font-size:'+B+"px; padding-right:"+Math.round(w)+'px">'+f[K.lang].days+"</figcaption></figure>":"$1").replace(/\$1/,t)+m}x.html(m)}else{c.extend(K,u)}var C=x.find("div");if(C.length<K.vals.length){var J=K.vals.length-C.length,A=K.vals,y=K.limits;K.vals=[];K.limits=[];for(G=0;G<C.length;G++){K.vals[G]=A[J+G];K.limits[G]=y[J+G]}K.iSec=K.vals.length-1;K.iHour=K.vals.length-5}K.sec=K.seconds;x.data(K);if(g&&a[g]){a[g].call(x,K.seconds)}else{if(K.start){a.start.call(x,K.seconds)}else{e.call(x,K.seconds)}}})};function e(r,g){var p=this.data(),x=this.find("ul"),t=false;if(!p.vals||x.length===0){return}if(!r){r=p.seconds}if(p.intervalId){t=true;clearTimeout(p.intervalId)}var z=Math.floor(r/86400),k=z*86400,q=Math.floor((r-k)/3600);k+=q*3600;var l=Math.floor((r-k)/60);k+=l*60;var A=r-k,w=(z<100?"0"+(z<10?"0":""):"")+z+(q<10?"0":"")+q+(l<10?"0":"")+l+(A<10?"0":"")+A;for(var o=p.vals.length-1,n=w.length-1,y;o>=0;o--,n--){y=parseInt(w.substr(n,1));p.vals[o]=y;x.eq(o).children().html(y)}if(t||g){var u=this;p.ttStartTime=Date.now();p.intervalId=setTimeout(function(){b.call(u)},1000);this.data("intervalId",p.intervalId)}}function b(o){var p=this.find("ul"),j=this.data();if(!j.vals||p.length==0){if(j.intervalId){clearTimeout(j.intervalId);this.data("intervalId",null)}if(j.callback){j.callback()}return}if(o==undefined){o=j.iSec}var h=j.vals[o],k=p.eq(o),m=k.children(),i=j.countdown?-1:1;m.eq(1).html(h);h+=i;if(o==j.iSec){var q=j.tickTimeout,g=(new Date()).getTime()-j.ttStartTime;j.sec+=i;q+=Math.abs(j.seconds-j.sec)*q-g;j.intervalId=setTimeout(function(){b.call(l)},q)}if(h<0||h>j.limits[o]){if(h<0){h=j.limits[o];if(o==j.iHour&&j.displayDays>0&&o>0&&j.vals[o-1]==0){h=3}}else{h=0}if(o>0){b.call(this,o-1)}}m.eq(0).html(h);var l=this;if(c.support.transition){k.addClass("transition");k.css({top:0});setTimeout(function(){k.removeClass("transition");m.eq(1).html(h);k.css({top:"-"+j.height+"px"});if(i>0||o!=j.iSec){return}if(j.sec==j.countdownAlertLimit){p.parent().addClass("timeTo-alert")}if(j.sec===0){p.parent().removeClass("timeTo-alert");if(j.intervalId){clearTimeout(j.intervalId);l.data("intervalId",null)}if(typeof j.callback==="function"){j.callback()}}},410)}else{k.stop().animate({top:0},400,o!=j.iSec?null:function(){m.eq(1).html(h);k.css({top:"-"+j.height+"px"});if(i>0||o!=j.iSec){return}if(j.sec==j.countdownAlertLimit){p.parent().addClass("timeTo-alert")}else{if(j.sec==0){p.parent().removeClass("timeTo-alert");if(j.intervalId){clearTimeout(j.intervalId);l.data("intervalId",null)}if(typeof j.callback==="function"){j.callback()}}}})}j.vals[o]=h}return jQuery}));